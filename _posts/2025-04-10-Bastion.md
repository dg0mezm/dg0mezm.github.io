---
title: "Bastion - HTB Machine - Writeup"
excerpt: ""
categories:
  - HackTheBox
  - Windows
tags:
  - HackTheBox
  - Machine
  - Writeup
image:
  path: /assets/img/HTB/Machines/Bastion/Bastion.png
---

## Reconocimiento

Realizamos un ping para verificar que tenemos trazabilidad con la máquina, además, podemos observar el valor del `ttl` para determinar el posible sistema operativo al que nos estamos enfrentando, aunque esto no lo confirma definitivamente:

```bash
ping -c 1 10.129.28.133 > enum/ping.txt

PING 10.129.28.133 (10.129.28.133) 56(84) bytes of data.
64 bytes from 10.129.28.133: icmp_seq=1 ttl=127 time=48.5 ms

--- 10.129.28.133 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 48.463/48.463/48.463/0.000 ms
```

### Enumeración de puertos

Ahora procedemos a realizar un escaeno de puertos, tanto UDP como TCP, para ello usaremos `nmap` realizando un `SYN-Scan` e indicando el parámetro `-p-` para enumerar todo el rango de puertos:

```bash
sudo nmap -sS -p- -T5 10.129.28.133 --open -Pn -oN enum/all_ports.txt -oG enum/all_ports.grep

# Nmap 7.95 scan initiated Fri Apr  4 14:13:32 2025 as: /usr/lib/nmap/nmap -sS -p- -T5 --open -Pn -oN enum/all_ports.txt -oG enum/all_ports.grep 10.129.28.133
Warning: 10.129.28.133 giving up on port because retransmission cap hit (2).
Nmap scan report for 10.129.28.133
Host is up (0.050s latency).
Not shown: 65417 closed tcp ports (reset), 105 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT      STATE SERVICE
22/tcp    open  ssh
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
5985/tcp  open  wsman
47001/tcp open  winrm
49664/tcp open  unknown
49665/tcp open  unknown
49666/tcp open  unknown
49667/tcp open  unknown
49668/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown

# Nmap done at Fri Apr  4 14:14:30 2025 -- 1 IP address (1 host up) scanned in 58.45 seconds
```

Como mencionamos anteriormente, también realizaremos un escaeno de los puertos UDP usando `nmap` indicando el parámetro `-sU`:

```bash
sudo nmap -sU -T5 10.129.28.133 --open -Pn -oN enum/nmap_udp_ports.txt

# Nmap 7.95 scan initiated Fri Apr  4 14:13:38 2025 as: /usr/lib/nmap/nmap -sU -T5 --open -Pn -oN enum/nmap_udp_ports.txt 10.129.28.133
Warning: 10.129.28.133 giving up on port because retransmission cap hit (2).
Nmap scan report for 10.129.28.133
Host is up (0.048s latency).
All 1000 scanned ports on 10.129.28.133 are in ignored states.
Not shown: 881 open|filtered udp ports (no-response), 119 closed udp ports (port-unreach)

# Nmap done at Fri Apr  4 14:15:44 2025 -- 1 IP address (1 host up) scanned in 126.43 seconds
```

### Enumeración de Servicios

Ahora que ya conocemos los puertos que están abiertos en la máquina, procederemos a enumerar que servicios están corriendo en dichos puertos, para ello, utilizaremos `nmap` con el parámetro `-sCV` para enumerar la versión de los servicios y a su vez, utilizar algunos scripts básicos de reconocimiento:

```bash
sudo nmap -sCV -p22,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669,49670 -A 10.129.28.133 -Pn -oN enum/all_services.txt

# Nmap 7.95 scan initiated Fri Apr  4 14:15:23 2025 as: /usr/lib/nmap/nmap -sCV -p22,135,139,445,5985,47001,49664,49665,49666,49667,49668,49669,49670 -A -Pn -oN enum/all_services.txt 10.129.28.133
Nmap scan report for 10.129.28.133
Host is up (0.048s latency).

PORT      STATE SERVICE      VERSION
22/tcp    open  ssh          OpenSSH for_Windows_7.9 (protocol 2.0)
| ssh-hostkey: 
|   2048 3a:56:ae:75:3c:78:0e:c8:56:4d:cb:1c:22:bf:45:8a (RSA)
|   256 cc:2e:56:ab:19:97:d5:bb:03:fb:82:cd:63:da:68:01 (ECDSA)
|_  256 93:5f:5d:aa:ca:9f:53:e7:f2:82:e6:64:a8:a3:a0:18 (ED25519)
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49668/tcp open  msrpc        Microsoft Windows RPC
49669/tcp open  msrpc        Microsoft Windows RPC
49670/tcp open  msrpc        Microsoft Windows RPC
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Device type: general purpose
Running: Microsoft Windows 2016
OS CPE: cpe:/o:microsoft:windows_server_2016
OS details: Microsoft Windows Server 2016
Network Distance: 2 hops
Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows

Host script results:
| smb-os-discovery: 
|   OS: Windows Server 2016 Standard 14393 (Windows Server 2016 Standard 6.3)
|   Computer name: Bastion
|   NetBIOS computer name: BASTION\x00
|   Workgroup: WORKGROUP\x00
|_  System time: 2025-04-04T14:16:24+02:00
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2025-04-04T12:16:22
|_  start_date: 2025-04-04T12:07:06
|_clock-skew: mean: -39m59s, deviation: 1h09m14s, median: -1s

TRACEROUTE (using port 135/tcp)
HOP RTT      ADDRESS
1   48.56 ms 10.10.14.1
2   48.78 ms 10.129.28.133

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Apr  4 14:16:31 2025 -- 1 IP address (1 host up) scanned in 68.13 seconds
```

